(trapped) error reading bcrypt version
Traceback (most recent call last):
  File "/home/mahammad/Programming/NFT-TICKETING/backend/venv/lib/python3.12/site-packages/passlib/handlers/bcrypt.py", line 620, in _load_backend_mixin
    version = _bcrypt.__about__.__version__
              ^^^^^^^^^^^^^^^^^
AttributeError: module 'bcrypt' has no attribute '__about__'
Using default admin password. Please set ADMIN_PASSWORD_HASH in .env!
2025-12-31 19:53:23,259 - data_science.core - INFO - Connected to Supabase for logging.
2025-12-31 19:53:24,234 - data_science.core - INFO - Loaded model risk_score from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/risk_score.joblib
2025-12-31 19:53:24,280 - data_science.core - INFO - Loaded model bot_detection from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/bot_detection.joblib
2025-12-31 19:53:24,297 - data_science.core - INFO - Loaded model fair_price from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/fair_price.joblib
2025-12-31 19:53:24,299 - data_science.core - INFO - Loaded model scalping_detection from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/scalping_detection.joblib
2025-12-31 19:53:24,603 - data_science.core - INFO - Loaded model wash_trading from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/wash_trading.joblib
2025-12-31 19:53:24,603 - data_science.core - INFO - Loaded model recommender from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/recommender.joblib
2025-12-31 19:53:24,626 - data_science.core - INFO - Loaded model segmentation from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/segmentation.joblib
2025-12-31 19:53:24,627 - data_science.core - INFO - Loaded model market_trend from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/market_trend.joblib
2025-12-31 19:53:24,627 - data_science.core - INFO - Loaded model decision_rule from /home/mahammad/Programming/NFT-TICKETING/backend/data_science/artifacts/decision_rule.joblib
Loading .env from /home/mahammad/Programming/NFT-TICKETING/backend/.env
Web3 Client Loaded. RPC: True, Key: True
Deployments file not found at /home/mahammad/Programming/NFT-TICKETING/deployments/sepolia.json
Warning: GEMINI_API_KEY not found in environment variables
============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-7.4.4, pluggy-1.6.0 -- /home/mahammad/Programming/NFT-TICKETING/backend/venv/bin/python
cachedir: .pytest_cache
rootdir: /home/mahammad/Programming/NFT-TICKETING/backend
configfile: pytest.ini
plugins: cov-4.1.0, asyncio-0.23.3, web3-6.15.1, anyio-4.12.0, Faker-22.2.0, dash-2.14.2
asyncio: mode=Mode.AUTO
collecting ... collected 1 item

tests/test_auth.py::TestAuthRegister::test_register_all_roles 2025-12-31 19:53:26,530 - httpx - INFO - HTTP Request: POST http://testserver/api/auth/register "HTTP/1.1 500 Internal Server Error"
DEBUG: Checking ban for user=None, ip=unknown
DEBUG: is_banned function: <function <lambda> at 0x7ac426f5ed40>
DEBUG: is_banned result: False
Error: 500 - {'detail': "Registration failed: 'created_at'"}
FAILED<unknown>:87: SyntaxWarning:

invalid escape sequence '\.'

/home/mahammad/Programming/NFT-TICKETING/backend/monitoring/dashboard.py:87: SyntaxWarning:

invalid escape sequence '\.'

<unknown>:87: SyntaxWarning:

invalid escape sequence '\.'

/home/mahammad/Programming/NFT-TICKETING/backend/monitoring/dashboard.py:87: SyntaxWarning:

invalid escape sequence '\.'

<unknown>:87: SyntaxWarning:

invalid escape sequence '\.'



=================================== FAILURES ===================================
___________________ TestAuthRegister.test_register_all_roles ___________________
/home/mahammad/Documents/NFT-TICKETING/backend/tests/test_auth.py:159: in test_register_all_roles
    ???
E   assert 500 == 201
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
E    +  and   201 = status.HTTP_201_CREATED
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1026 HTTP Request: POST http://testserver/api/auth/register "HTTP/1.1 500 Internal Server Error"
=============================== warnings summary ===============================
venv/lib/python3.12/site-packages/supabase/__init__.py:1
  /home/mahammad/Programming/NFT-TICKETING/backend/venv/lib/python3.12/site-packages/supabase/__init__.py:1: DeprecationWarning:
  
  The `gotrue` package is deprecated, is not going to receive updates in the future. Please, use `supabase_auth` instead.

venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /home/mahammad/Programming/NFT-TICKETING/backend/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning:
  
  'crypt' is deprecated and slated for removal in Python 3.13

routers/admin.py:644
  /home/mahammad/Programming/NFT-TICKETING/backend/routers/admin.py:644: DeprecationWarning:
  
  `regex` has been deprecated, please use `pattern` instead

venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:271
  /home/mahammad/Programming/NFT-TICKETING/backend/venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:271: PydanticDeprecatedSince20:
  
  Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/

routers/admin.py:974
  /home/mahammad/Programming/NFT-TICKETING/backend/routers/admin.py:974: DeprecationWarning:
  
  `regex` has been deprecated, please use `pattern` instead

tests/test_auth.py::TestAuthRegister::test_register_all_roles
  /home/mahammad/Programming/NFT-TICKETING/backend/venv/lib/python3.12/site-packages/httpx/_client.py:680: DeprecationWarning:
  
  The 'app' shortcut is now deprecated. Use the explicit style 'transport=WSGITransport(app=...)' instead.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform linux, python 3.12.3-final-0 -----------
Name                                        Stmts   Miss  Cover   Missing
-------------------------------------------------------------------------
attack_tracking.py                             93     80    14%   51-226, 231-239, 244-255
auth_middleware.py                             45     33    27%   19-69, 80-86, 92-101
auth_utils.py                                  53     14    74%   31, 39, 62-71, 86, 89, 92, 95, 98
cache.py                                       73     55    25%   19-25, 31-37, 43-51, 56-66, 71-74, 84, 90-95, 100-131, 136-137
data_control/__init__.py                        0      0   100%
data_control/data_retention.py                 96     96     0%   2-184
data_control/db_connection.py                  70     70     0%   2-115
data_control/etl_pipeline.py                  140    140     0%   2-344
data_science/__init__.py                        0      0   100%
data_science/core.py                          124     55    56%   19-20, 37-38, 41-66, 77, 80, 87-90, 93-96, 113-114, 120-133, 136-138, 161-164, 168-175, 184-186, 190, 194
data_science/data_loader.py                   112     92    18%   26, 45-59, 76-88, 105-117, 134-148, 162-172, 184-194, 206-215, 242-258, 279-296, 319-333, 347-372, 390-392
data_science/feature_store.py                  91     64    30%   9-10, 32-49, 53-61, 65-81, 96-102, 116-124, 140, 157, 173-188, 205-219
data_science/models/__init__.py                 0      0   100%
data_science/models/bot_detection.py           86     68    21%   11-12, 23, 27-93, 96-141
data_science/models/decision_rule.py           53     34    36%   22, 28-39, 46-85
data_science/models/fair_price.py              80     63    21%   12-13, 21, 24-83, 86-125
data_science/models/market_trend.py            74     55    26%   13-14, 26, 32-74, 81-112
data_science/models/recommender.py             39     24    38%   28-42, 49-78
data_science/models/risk_score.py             127    107    16%   12-13, 25, 33-115, 132-191, 195-201, 205-238
data_science/models/scalping_detection.py      81     63    22%   13-14, 22, 25-88, 91-131
data_science/models/segmentation.py            70     51    27%   13-14, 26, 32-66, 73-110
data_science/models/wash_trading.py            69     51    26%   13-14, 27-46, 53-108
data_science/storage/__init__.py                2      2     0%   2-4
data_science/storage/duckdb_storage.py         95     95     0%   6-376
database.py                                   176    137    22%   21, 31-32, 36-38, 41, 45-50, 53-54, 57-58, 61-62, 65-66, 69-71, 74-115, 118-149, 153-154, 161-163, 174, 179, 183-250, 253
logging_system.py                              92     26    72%   142-179, 183-208, 227, 231
main.py                                        91     28    69%   39-41, 53-76, 129, 140, 149-150, 155, 159-160
middleware_metrics.py                          22      3    86%   47-53
models.py                                     110      0   100%
monitoring.py                                  38     38     0%   2-112
monitoring/__init__.py                         38     19    50%   77-108, 112
monitoring/alert_rules.py                     109    109     0%   2-262
monitoring/dashboard.py                       163    111    32%   50-52, 101-115, 120-136, 140-219, 429-430, 451-494, 501-509, 519-535, 545-562, 572, 575-576
monitoring/monitoring_api.py                  193    193     0%   2-372
monitoring/soar_engine.py                      60     60     0%   2-114
routers/__init__.py                             2      0   100%
routers/admin.py                              715    536    25%   85-146, 167-206, 219-240, 254-371, 384-431, 444-482, 495-556, 571-591, 603-629, 649-708, 777-964, 979-1024, 1038-1076, 1089-1135, 1173-1227, 1241-1292, 1305-1349, 1363-1389, 1404-1418, 1457-1477, 1489-1493, 1507-1534, 1547-1563, 1576-1630
routers/admin_auth.py                         180    128    29%   64-71, 76-82, 87-115, 120-213, 219-241, 247-258, 269-329, 346-356, 369-378, 383-398, 406-411
routers/auth.py                               218    164    25%   36-102, 116, 124, 132, 160, 206-225, 228, 243-357, 370-452, 464-474, 486-517, 529-582, 594-638, 649
routers/chatbot.py                             36     12    67%   17-18, 39-56, 63
routers/events.py                             234    216     8%   21-125, 135-251, 260-375, 384-417, 426-466
routers/marketplace.py                        295    256    13%   19-28, 39-173, 182-257, 266-277, 287-303, 313-340, 349-354, 364-394, 401-438, 442-447, 454-476, 480-485, 489-494, 498-503
routers/ml_services.py                         52     32    38%   21-23, 28, 38-40, 57-81, 91-116, 122-142
routers/ml_services_backend.py                 88     88     0%   6-274
routers/ml_services_v2.py                     145     75    48%   20-22, 81, 103-116, 122-129, 135-142, 148-155, 161-168, 174-181, 187-199, 205-212, 218-229, 235-253
routers/tickets.py                            384    346    10%   20-29, 38-40, 48-255, 268-413, 422-463, 472-546, 556-565, 574-584, 591-603, 614-664, 668-678, 682-692, 696-707
routers/wallet.py                              15      8    47%   19-43
security_middleware.py                        264    169    36%   123, 128, 135, 140, 147, 152, 159, 164, 170-198, 203-210, 215-229, 243-341, 352-397, 402-443, 457-458, 466-472, 480, 494-495, 499-506, 520-523, 525-528, 533-536, 538-541, 546-549, 551-554, 558-561, 572-575, 581-598
sentry_config.py                               21     15    29%   12-42
soar_integration.py                           131     94    28%   62-68, 72, 84, 92, 96-98, 114-152, 165-209, 226-246, 263-283, 296-316, 326-328
tests/__init__.py                               0      0   100%
tests/conftest.py                              82     12    85%   93, 125, 144, 163, 186, 204, 216-223, 229-236
tests/test_auth.py                            249    197    21%   13-78, 83-96, 100-108, 112-123, 160-161, 169-194, 199-210, 214-230, 234-254, 258-279, 284-297, 305-331, 335-340, 344-352, 356-371, 379-390, 398-406, 410-411, 419-433, 437-445, 449-478, 482-490, 494-508, 516-542, 546-560, 564-571, 575-589
tests/test_chatbot.py                          27     27     0%   1-40
tests/test_events_expanded.py                 109    109     0%   2-284
tests/test_integration.py                      52     52     0%   2-150
tests/test_marketplace.py                      78     78     0%   2-216
tests/test_security_middleware.py              24     24     0%   2-69
tests/test_tickets.py                          79     79     0%   2-195
tests/test_wallet.py                           27     27     0%   2-58
verify_consolidation_components.py             85     85     0%   2-129
verify_db_integration.py                      141    141     0%   6-243
web3_client.py                                 50     24    52%   22, 25, 32, 44-58, 67-92
web_requests_middleware.py                     93     72    23%   38-158, 180-205, 210-220, 224-239
-------------------------------------------------------------------------
TOTAL                                        6641   5102    23%
Coverage HTML written to dir htmlcov

=========================== short test summary info ============================
FAILED tests/test_auth.py::TestAuthRegister::test_register_all_roles - assert...
======================== 1 failed, 6 warnings in 1.68s =========================
